# Github demo on Auto deployment for Lambda Web Application


A sample web application as a serverless worklaload with its Infrastructure as Code for demonstration  continuos deployment
This project will deploy following AWS services 
  1. A Lambda function with a function which prints the request header, method, and body
  2. Role and policy for AWS Lambda function
  3. An API Gateway integrate with Lambda function

This  project architecture demonstrates how to use AWS Lambda in conjunction with Amazon API Gateway, Amazon DynamoDB to build a serverless web application.
This project also has a .github directory which defines a workflow build and deploy the terraform code 

## Pre- Requisites
 - An AWS Account with user credentials with permission to deploy AWS resources ( Eg: Attach role: Administrator)
 - configure Terraform to reference your AWS account
 - A Github/GitLab account reference your AWS account
 - Secret variables added for AWS credentials ,Please refer[this page](https://docs.github.com/en/actions/security-guides/encrypted-secrets)


## Features

- .github/workflows/terraform.yml defines a deployment workflow for the project
- .gitlab.yaml defines a gitlab build an deployment pipeline for the project

  



## Test case
curl --header "Content-Type: application/json" --data '{"username":"xyz","password":"xyz"}' http://${URL}:${PORT}/api
Response:

Welcome to our demo API, here are the details of your request:

Headers: Content-Type: application/json

Method: Get Body: {"username":"xyz", "password":"xyz"}

For Verify the code functionality , Execute the below code
```shell script
$ curl $(terraform output -raw wm-read_url)
```


[comment]: # ( An optional Route53 module   to bind the domain url to privatesubnet of  We b VPC)


## Usage

- Update .config file in backend-config/ directory to set appropriate backend for each environment
- Initiate terraform with the configured backend using below command:
##Feature branch workflow
####1. Clone project:
    ```shell script
    git clone https://github.com/jomcy-amzn/wm-serverlesslambda.git
    ```
####2.Create branch with your feature:
   ```shell script
    git checkout -b feature_name
  ```

####3. Write code. Commit changes:
   ```shell script
   git commit -am "My feature is ready"
   ```
####4. Run and validate the deployments
   - Update .tfvars present in environments directory with VPC ,subnet and other details
   - Based on the environment execute below commands to plan or deploy the infrastucture
   
```shell script
   terraform init -backend-config=backend-configs/dev.config
   terraform plan -var-file=environments/dev.tfvars
   terraform apply -var-file=environments/dev.tfvars
```

 - For clean up destroy the infrastucture as shown below
   ~~~
   terraform destroy -var-file=environments/dev.tfvars
   ~~~
####5. Push your branch to GitLab:
```shell script
git push origin feature_name
```
####6. Review your code on commits page.

####7. Create a merge request.

####8. Let our team lead reviews the code and merges it to the main branch.


## Details
This session is autogenerated by terraform-docs

<!--- BEGIN_TF_DOCS --->


<!--- END_TF_DOCS --->


<!-- BEGINNING OF PRE-COMMIT-TERRAFORM DOCS HOOK -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | 1.1.5 |
| <a name="requirement_archive"></a> [archive](#requirement\_archive) | 2.2.0 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | 3.74.0 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | 3.74.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | 3.74.0 |

## Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_wm-apigw"></a> [wm-apigw](#module\_wm-apigw) | ./modules/api-gateway | n/a |
| <a name="module_wm-lambda"></a> [wm-lambda](#module\_wm-lambda) | ./modules/lambda | n/a |

## Resources

| Name | Type |
|------|------|
| [aws_caller_identity.current](https://registry.terraform.io/providers/hashicorp/aws/3.74.0/docs/data-sources/caller_identity) | data source |
| [aws_partition.current](https://registry.terraform.io/providers/hashicorp/aws/3.74.0/docs/data-sources/partition) | data source |
| [aws_region.current](https://registry.terraform.io/providers/hashicorp/aws/3.74.0/docs/data-sources/region) | data source |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_apigw_name"></a> [apigw\_name](#input\_apigw\_name) | Name of Api gateway | `string` | `"my_lambda_api_gateway"` | no |
| <a name="input_lambda_name"></a> [lambda\_name](#input\_lambda\_name) | Name of Lambda function | `string` | `"my_lambda_fucntion"` | no |
| <a name="input_region"></a> [region](#input\_region) | Region for deploying infrastucture | `string` | `"us-west-2"` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_wm-read_url"></a> [wm-read\_url](#output\_wm-read\_url) | n/a |
<!-- END OF PRE-COMMIT-TERRAFORM DOCS HOOK -->
